<!DOCTYPE html>
<html lang="pl">
<head id="head1" runat="server">
    <meta charset="utf-8" />
	<link rel="stylesheet" href="stylelogowanie.css" type="text/css" />

    <script type="text/javascript">


        async function logIn() {
            var myHeaders = new Headers();
            myHeaders.append("Content-Type", "application/json");

            var raw = JSON.stringify({
                "email": document.getElementById("login").value,
                "password": document.getElementById("password").value
                // "email": "test@abc.pl",
                //"password":"test1234"
            });

            var requestOptions = {
                method: 'POST',
                headers: myHeaders,
                body: raw,
                redirect: 'follow'
            };

            fetch("https://localhost:7259/api/token", requestOptions)
                .then(response => {
                    if (response.ok) {
                        localStorage.setItem("email", document.getElementById("login").value);
                        return response.text()
                            .then(data => {
                                document.cookie = `access_token=${data}`
                                localStorage.setItem("tokenik", data);
                                console.log(document.cookie);
                                window.location.href = "https://localhost:7259/api/user/admin"
                            })
                    }
                })
        }

        let wynik;
        async function getRandom() {
            sessionStorage.setItem("email", document.getElementById("login").value);

            const random = Math.floor(Math.random() * 50);
            const email = sessionStorage.getItem("email");

            document.getElementById("randomNumber").innerHTML = random;
            document.getElementById("emailLenght").innerHTML = email;



            wynik = (email.length * Math.sin(random));
            document.getElementById("totpPass").value = wynik.toPrecision(2);
            console.log(wynik.toPrecision(2));


        }
        
        function oneTimePass() {

            if (document.getElementById("password").value == wynik.toPrecision(2)) {
                window.location.replace("https://localhost:7259/api/user/user");
            } else alert("Podano niepoprawne haslo");

        }



        function redirect() {
            window.location.replace("https://localhost:7259/api/user/homepage")
        }
</script>


</head>
<body>

<form autocomplete="off">
<div class ="icon" aria-hidden="true"></div>
<div class="container">
<input type="text" id="login" placeholder=" "/>
<label for ="login">Login</label>
</div>

<div class="container">
<input type="password" id="password" placeholder=" "/>
<label for ="password">Hasło</label>
</div>

<div class ="spacer"></div>

<button onclick="logIn()">Zaloguj</button>

<div id="wynik"></div>
</div>
</form>
</body>
</html>